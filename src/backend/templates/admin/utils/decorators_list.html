{% extends "admin/utils/utils_base.html" %}

{% block utils_content %}
<h2>ğŸ“œ Ğ ĞµĞµÑÑ‚Ñ€ Ğ´ĞµĞºĞ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²</h2>

<!-- ĞŸĞ¾Ğ»Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ -->
<table style="width: 100%; margin-bottom: 10px;">
    <tr>
        <td style="width: 30%; text-align: right;">
            <label for="function-search"><strong>ğŸ” ĞĞ°Ğ¹Ñ‚Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ:</strong></label>
        </td>
        <td style="width: 40%;">
            <input type="text" id="function-search" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸..." style="width: 100%;">
        </td>
        <td style="width: 30%;">
            <button id="clear-search" style="width: 50px;">âŒ</button>
        </td>
    </tr>
</table>

<div class="scrollable-table">
    <table id="decoratorTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">ğŸ›¡ Ğ ĞĞ›Ğ¬</th>
                <th onclick="sortTable(1)">ğŸ”„ Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ•</th>
                <th onclick="sortTable(2)">ğŸ“Œ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯</th>
                <th onclick="sortTable(3)">âš™ï¸ Ğ”Ğ•ĞšĞĞ ĞĞ¢ĞĞ </th>
                <th onclick="sortTable(4)">ğŸ“¦ ĞœĞĞ”Ğ£Ğ›Ğ¬</th>
                <th onclick="sortTable(5)">ğŸ“„ ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ•</th>
            </tr>
        </thead>
        <tbody>
            {% for item in decorated_functions %}
            <tr>
                <td>{{ item.required_role or "â€”" }}</td>
                <td>{{ item.required_state or "â€”" }}</td>
                <td>{{ item.function_name }}</td>
                <td>{{ item.decorator }}</td>
                <td>{{ item.module }}</td>
                <td>{{ item.description }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

<script>
document.getElementById("function-search").addEventListener("input", function() {
    let searchValue = this.value.toLowerCase();
    let rows = document.querySelectorAll("#decoratorTable tbody tr");

    rows.forEach(row => {
        let functionName = row.cells[2].innerText.toLowerCase();
        if (functionName.includes(searchValue)) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
});

// ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ Ğ¿Ğ¾Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ°
document.getElementById("clear-search").addEventListener("click", function() {
    document.getElementById("function-search").value = "";
    let rows = document.querySelectorAll("#decoratorTable tbody tr");
    rows.forEach(row => row.style.display = ""); // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
});

function sortTable(columnIndex) {
    let table = document.getElementById("decoratorTable");
    let rows = Array.from(table.rows).slice(1); // ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº
    let sortedRows = rows.sort((rowA, rowB) => {
        let cellA = rowA.cells[columnIndex].innerText.toLowerCase();
        let cellB = rowB.cells[columnIndex].innerText.toLowerCase();
        return cellA.localeCompare(cellB);
    });
    table.tBodies[0].append(...sortedRows);
}
</script>
</div>
{% endblock %}
