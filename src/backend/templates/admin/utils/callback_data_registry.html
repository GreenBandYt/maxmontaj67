{% extends "admin/utils/utils_base.html" %}

{% block utils_content %}
<h2>üìú –†–µ–µ—Å—Ç—Ä callback_data</h2>

<!-- –í–≤–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ -->
<div class="function-search">
    <table style="width: 100%;">
        <tr>
            <td style="width: 30%;"><label for="function-search">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏:</label></td>
            <td style="width: 40%;"><input type="text" id="function-search" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏..."></td>
            <td style="width: 30%;"><button id="clear-search">‚ùå</button></td>
        </tr>
    </table>
    <div id="search-result"></div> <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
</div>

<div class="scrollable-table">
    <table id="callbackTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">üìå CALLBACK DATA</th>
                <th onclick="sortTable(1)">‚öôÔ∏è –§–£–ù–ö–¶–ò–Ø</th>
                <th onclick="sortTable(2)">üì¶ –ú–û–î–£–õ–¨</th>
                <th onclick="sortTable(3)">üìÑ –û–ü–ò–°–ê–ù–ò–ï</th>
            </tr>
        </thead>
        <tbody>
            {% for item in callback_registry %}
            <tr>
                <td>{{ item.callback }}</td>
                <td>{{ item.function }}</td>
                <td>{{ item.module }}</td>
                <td>{{ item.description }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    const functionSearchInput = document.getElementById("function-search");
    const clearSearchButton = document.getElementById("clear-search");
    const searchResultDiv = document.getElementById("search-result");

    const functions = [
        {% for item in callback_registry %}
            { name: "{{ item.function }}", callback: "{{ item.callback }}" },
        {% endfor %}
    ];

    functionSearchInput.addEventListener("input", function() {
        const searchQuery = functionSearchInput.value.toLowerCase();
        const results = functions.filter(function(item) {
            return item.name.toLowerCase().includes(searchQuery);
        });

        displayResults(results);
    });

    clearSearchButton.addEventListener("click", function() {
        functionSearchInput.value = ""; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
        searchResultDiv.innerHTML = ""; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    });

    function displayResults(results) {
        searchResultDiv.innerHTML = results.length
            ? results.map(result => `<div>${result.name}</div>`).join("")
            : "–ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π";
    }
</script>


{% endblock %}
